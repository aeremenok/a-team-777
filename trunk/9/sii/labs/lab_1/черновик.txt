// БАЗА ЗНАНИЙ, КОТОРАЯ ПОЙДЕТ В КОМПИЛЯТОР


/////////////////////////////////////
// ТЕКСТ ОСТАВЛЕН ДЛЯ АВТОЗАПОЛНЕНИЯ:

      ОПИСАНИЕ КОМПИЛЯТОРА ПРАВИЛ ДЛЯ ПОСТРОЕНИЯ
      БАЗЫ ЗНАНИЙ ЭКСПЕРТНОЙ СИСТЕМЫ КЛАССА ЭСТЭР


         Компилятор  правил ESTERC позволяет осуществить подготовку
      продукционной базы знаний для экспертной системы класса ESTER
      с   помощью  любого  текстового  редактора,  работающего  под
      управлением  MS-DOS.   ESTERC  состоит  из   языка   описания
      продукционных  знаний  и выполняющей компиляцию программы.  В
      результате работы ESTERC создаются файлы базы знаний  .TXT  и
      .RUL    полностью   совместимые   с   аналогичными   файлами,
      подготовленными редактором базы знаний REDBAZ,  любой  версии
      системы ESTER.


      ЯЗЫК ОПИСАНИЯ БАЗЫ ЗНАНИЙ В СИСТЕМЕ ESTER


       COMMENTS: /*
       Пример:
               /* это комментарий
               QUALIFIERS:         /* это другой Пример


       SUBJECT:<текст>
       Пример:
              SUBJECT: это заголовок экспертной системы
       или
              SUBJECT:    Эта   строка   заголовка,   которая  м.б.
              продолжена на три строки.   ESTER  3.0  рассматривает
              всю эту часть как единый заголовок.

       AUTHOR:<текст>
       Пример:
              AUTHOR: Ваше имя, фамилия


       STARTING TEXT: <текст>
       Пример:
              STARTING  TEXT:   этот  текст  будет  отображаться на
              экране, когда экспертная система начинает работу.


       ENDING TEXT:<текст>
       Пример:
              ENDING TEXT:этот текст будет отображаться на экране в
              конце работы экспертной системы.


       EXTERNAL PROGRAM:<текст>
       Пример:
              EXTERNAL PROGRAM: TEST [ X ] /C
      будет  вызвана  внешняя  программа TEST и значение переменной
      [X] будет передано в командной строке этой программе


       DISPLAY THRESHOLD:<значение>
       Пример:
              DISPLAY THRESHOLD: 5
              будут  учитываться  решение  со  значением истинности
              (уверенности) больше  5  и  отображаться  в  качестве
              результатов вывода.


       PROBABILITY SYSTEM:<значение>
       Пример:
              PROBABILITY SYSTEM: 2
              учитывается система неопределенности 0-10.
              PROBABILITY SYSTEM: 3 I
              будет  активизирована система [-100,+100] с вариантом
              условных вероятностей.


       INITIAL CHOICE CONFIDENCE:<значение>
       Пример:
              INITIAL CHOICE CONFIDENCE:  100
              начальное значение уверенности (истинности) для  всех
              решений будет установлено равным 100.


       DISPLAY RULES:<значение>
       Пример:
              DISPLAY RULES: YES
              будут  отображаться  правила  участвующие  в процессе
              вывода.


       DERIVATION:<значение>
       Пример:
              DERIVATION:F
              DERIVATION: First rule
              допустимы эти оба варианта записи, которые  означают,
              что  используется только первое правило, приводящее к
              заключению (решению).


       QUALIFIERS:
       Q> <текст>
       V> <текст>
       V> <текст>

       ASK CONFIDENCE
           Сокращенно: ASK CONF

       DEFAULT CONFIDENCE=<значение>
           Сокращенно: DEF CONF

       MINIMUM CONFIDENCE=<значение>
           Сокращенно: MIN CONF

       MAXIMUM CONFIDENCE=<значение>
           Сокращенно: MAX CONF

       DISPLAY AT END
           Сокращенно: DISP END,DISPLAY,DISP

       DEFAULT VALUE=<значение>
           Сокращенно: DEF VAL

       MAXIMUM ACCEPTABLE=<значение>
           Сокращенно: MAX ACCEPT,MAXIMUM,MAX

       DISPLAY CONFIDENCE
           Сокращенно: DISP CONF

       NAME=<name>

       Пример:
              QUALIFIERS:    /* начало списка показателей
              Q>  Цвет       /*  показатель 1
              V>  красный
              V>  былый
              V>  голубой
              NAME= Цвет одежды
              DISPLAY AT END
              DEFAULT VALUE= 2

              Q> День недели         /*  показатель 2
              V>  понедельник
              V>  вторник
              V>  среда
              V>  четверг
              V>  пятница
              V>  суббота
              V>  воскресенье
              NAME=  День недели
              MAXIMUM= 1

              /*  следующий показатель в списке


       VARIABLES:
       ASK CONFIDENCE
           Сокращенно: ASK CONF

       DEFAULT CONFIDENCE = <значение>
           Сокращенно: DEF CONF

       MINIMUM CONFIDENCE = <значение>
           Сокращенно: MIN CONF

       MAXIMUM CONFIDENCE = <значение>
           Сокращенно: MAX CONF

       DISPLAY AT END = <значение>
           Сокращенно: DISP END,DISPLAY,DISP

       TYPE = <значение>

       INITIALIZE = <значение>
           Сокращенно: INIT

       UPPER LIMIT = <значение>
           Сокращенно: UPPER LIM, UPPER

       LOWER LIMIT = <значение>
           Сокращенно: LOWER LIM, LOWER

       DISPLAY CONFIDENCE
           Сокращенно: DISP CONF

       Пример:
              VARIABLES:       /*  начало списка переменных

              [ LENGTH ]  Длина реки измеряется в км от истока до
              устья
              DISPLAY
              UPPER LIMIT = 1000
              LOWER LIMIT = 0

              [ СООБЩЕНИЕ ] ПРЕДУПРЕЖДАЮ!   выделяющийся  газ  м.б.
              опасен для здоровья
              DISPLAY
              TYPE = T

              [X]  RUN(GETLTH)  Длина . . .  /* Только один пробел!

              /* следующие переменные


       CHOICES:
       Пример:
              CHOICES:     /*  начало списка решений

              C> Решение 1
              C> Решение 2
              C>  Этот  текст,  характеризующий  решение  3,  может
              занимать две строки
              C> Решение 4

              /* Четыре решения заданы текстом.


       LIST ONLY


       RULE:
       IF:
              Команды  RULE:   и  IF:   определяют  начало правила,
              которое имеет следующую структуру:

            RULE:   < необязательное имя >

            IF: < необязательное имя >
                       if_условие 1
                  AND: if_условие 2
                  AND: if_условие 3
                  AND:    ....

           THEN:
                       then_условие 1
                  AND: then_условие 2
                  AND: then_условие 3
                  AND:    ....

           ELSE:
                       else_условие 1
                  AND: else_условие 2
                  AND: else_условие 3
                  AND:    ....

           NOTE: < текст примечания>
           REFERENCE: < текст ссылки>
                    -------------------------

       Условия правил, построенные на основе показателей:

              показатель              [NOT]              (значение)
              [or][and][(значение)][поясняющий текст]
               ------------------
              Содержащееся [] является необязательным
              Подчеркнутое может быть повторено многократно
              Заключенное в круглые скобки - минимально требуемое

       Пример:
          условие:
                    [КИРПИЧ] КРАСНЫЙ

          будет установлен показатель

                    ________ КРАСНЫЙ

          со значением КИРПИЧ

                          ----------------------

       Условия-решения в правилах:

           Система учета неопределенности 1,2,3,4:

           IF:
                >решение[:][-]Вероятность <тест> <значение>
           THEN/ELSE:
                >решение[:][-]Вероятность [=] <значение>

           Система 5, использующая заданные пользователем выражения:

           IF:
                >решение[:][-]Вероятность <тест> <выражение>
           THEN/ELSE:
                >решение[:][-]Вероятность [=] <выражение>

              Заключенное в [] является необязательным
              Заключенное в () - минимально требуемое.

       Пример:

           IF:
                > Решение 2: Вер.< 4
           THEN:
                > Решение 1: Вероятность = 7

      Символ > в начале условия обозначает, что "условием" является
      решение.   Если  вероятность  для "Решение 2" меньше 4, тогда
      "Решению 1" будет присвоено значение 7 в системе 0-10.

       Если используется система 5, то:

           IF:
                > Решение 2: Вер.< [X]/5
           THEN:
                > Решение 1: Вероятность = [%Q 1] + 10

                          -------------

       Формульные условия в правилах:

           IF часть
                  <выражение><тест><выражение>

           THEN/ELSE часть
               <переменная> ЗАДАНО ЗНАЧЕНИЕ <выражение>
           or  <переменная> := <выражение>

       Пример:

           IF:

               "abc"+[Y] <> [X]

              не  будет  интерпретировано  правильно,  т.к.  должно
              быть

           IF:
               M> "abc"+[Y] <> [X]

              где записана "строковая"  формула  и  произведена  ее
              оценка

                          ---------------

       Текстовые условия в правилах:

           Только для текстовой переменной
                         T> текст
           or            "текст"
           or            [только имя текстовой переменной]

           Для команд:
                         X> команда

       Пример:

           IF:
                 RUN(GETCOLOR)  Цвет одежды  [красный]
           THEN:
                 T>  это примечание о том, что выбранный цвет
                     одежды - красный
                 X> RUN(TEST2 [Y] /C)



       Текст в примечании и в ссылке:

           NOTE: <текст>
           REFERENCE: <текст>

                          ---------------

       Специальные случаи:
       Пример:

           RULE: Цвет

           IF:
                       Цвет [красный] or [голубой]
           AND:        >Решение 1:PROB.>5
           AND:        [X]>10

           THEN:

                       Состояние есть [A] and [B]
           AND:        [Y] ЗАДАНО ЗНАЧЕНИЕE [X]/2
           AND:        >Состояние определено: PROBABILITY=9

           NOTE: Это примечание к правилу.


       -----------------------------------------------------------

           ОБОБЩЕНИЕ КОМАНД КОМПИЛЯТОРА ПРАВИЛ

                        Э С Т Э Р


       Начало работы:
              ESTERC имя_файла [режимы]

       Режимы:
               SAVE_STANDARD  создаются файлы базы знаний
                          совместимые с  ESTER версии меньшей 3.0
               LIST_ONLY  принимаются только значения в списках
               OUT=<имя_выходного_файла>  результаты компиляции
                          будут помещены в названный файл

             --------------------------------


              Используемые  имена  команд  и  структура  текстового
              представления базы знаний до компиляции следующие:

       /*    обозначает начало коментариев, т.е. текст, следующий
             следом за этим знаком, игнорируется компилятором
       SUBJECT:  следует текст описания предметной области
                 (задачи) экспертной системы
       AUTHOR:   следуют атрибуты автора базы знаний
       STARTING TEXT:   текст начала работы экспертной системы
       ENDING TEXT:   текст, сопровождающий завершение вывода
       EXTERNAL PROGRAM:   указывается имя вызываемой в начале
                           работы ЭС внешней программы
       DISPLAY THRESHOLD:  указывается уровень истинности
                           с которого отображаются решения
       PROBABILITY SYSTEM:   задается один из пяти вариантов
                           системы учета неопределенности
                     1 - ДА/НЕТ
                     2 - 0-10
                     3 - -100 до 100
                            A - усреднение
                            I - зависимые вероятности
                            D - независимые

       INITIAL CHOICE CONFIDENCE: указывается начальное значение
                                  истинности для всех решений
       DISPLAY RULES:   указывается Y или YES,N или NO
              для  отображения  или неотображения правил в процессе
              вывода
       DERIVATION:   Указывается A (все правила), F (только первое
              правило) или N (неизлишние правила).  В первом случае
              для  вывода  используются все правила БЗ, во втором -
              только   те    правила,    которые    дадут    первый
              успех(заключение),   в  третьем  случае  используются
              подмножество    правил    неизбыточное    в    смысле
              одинаковости заключений
       QUALIFIERS:   следует список показателей и их значений
       VARIABLES:    следует список переменных и их значений
       CHOICES:   следует список решений (заключений ЭС)
       LIST ONLY   указывает на использование только значений
              приведенных   в   списках   (эта    команда    должна
              присутствовать  в  файле  или быть задана в командной
              строке)
       RULE:   записывается необязательное имя правила и само
              правило со всеми составными частями
       IF:     записывается необязательное имя и следует список
              IF-условий
       THEN:   следует список THEN-условий (заключений,решений)
       ELSE:   следует список ELSE-условий
       NOTE:   дается текст примечания
       REFERENCE: дается текст ссылки, которая отображается только
                  по запросу пользователя в процессе работы

               -----------------------------


       QUALIFIER:

            Q>  <текст>
            Определяет начало нового показателя.
            (Требуется обязательно)

            V>  <текст>
            Определяет начало нового значения.
            (Требуется обязательно, хотя бы один раз в списке)

            ASK CONFIDENCE
                  Сокращенно: ASK CONF
            Устанавливает состояние опроса пользователя о
            значении истинности (уверенности, неопределенности)
            (По умолчанию опроса нет)

            DEFAULT CONFIDENCE = <значение>
                  Сокращенно: DEF CONF
            Устанавливает значение по умолчанию.
             (По умолчанию DEF CONF = 1)

            MINIMUM CONFIDENCE = <значение>
                  Сокращенно: MIN CONF
            Устанавливает минимальное значение истинности,
            участвующее в ранжировании (По умолчанию - 0)

            MAXIMUM CONFIDENCE = <значение>
                  Сокращенно: MAX CONF
            Устанавливает максимальное значение истинности,
            участвующее в ранжировании (По умолчанию - 100)

            DISPLAY AT END
                  Сокращенно: DISP END,DISPLAY,DISP
            Отобразить в конце вместе с результатами
            (По умолчанию - не отображать)

            DEFAULT VALUE = <значение>
                  Сокращенно: DEF VAL
            становить значение по умолчанию (По умолчанию -
            нет)
            MAXIMUM ACCEPTABLE = <значение>
                  Сокращенно: MAX ACCEPT,MAXIMUM,MAX
            Максимальное число значений, которые пользователь
            может выбрать. (По умолчанию - все указанные значения)

            DISPLAY CONFIDENCE
                  Сокращенно: DISP CONF
            Истинность (уверенность, вероятность) отображается
            вместе с показателем
            (По умолчанию не отображается)

            NAME: <имя показателя>
            Указывается имя показателя, которое ставится ему
            в соответствие.
            (По умолчанию имени нет)

               ----------------------------


       VARIABLE:

            [<имя_переменной>]  <поясняющий текст>
            Определяет начало новой переменнной.
            (Требуется обязательно)

            ASK CONFIDENCE
                 Сокращенно: ASK CONF
            Запрос об истинности (вероятности)
            (По умолчанию - запроса нет)

            DEFAULT CONFIDENCE = <значение>
                 Сокращенно: DEF CONF
            Задание значения истинности, которое затем принимается
            по умолчанию
            (По умолчанию - 1 )

            MINIMUM CONFIDENCE = <значение>
                 Сокращенно: MIN CONF
            Минимальное значение истинности (уверенности,
            вероятности) участвующее в ранжировании решений
            (По умолчанию   =   0)

            MAXIMUM CONFIDENCE = <значение>
                 Сокращенно: MAX CONF
            Максимальное значение истинности, участвующее
            в ранжировании.
            (По умолчанию  =  100 )

            DISPLAY AT END
                 Сокращенно: DISP END, DISPLAY, DISP
            Отобразить в конце работы вместе с результатами
            (По умолчанию - не отображать)

            TYPE = <значение>
            Тип переменной. (По умолчанию = N - численная)

            INITIALIZE = <значение>
                 Сокращенно: INIT
            Начальное значение переменной.
            (По умолчанию - переменная не инициализирована)

            UPPER LIMIT = <значение>
                 Сокращенно: UPPER LIM, UPPER
            Верхний предел значения переменной
            (По умолчанию - нет ограничений)

            LOWER LIMIT = <значение>
                 Сокращенно: LOWER LIM, LOWER
            Нижний предел значений переменной
            (По умолчанию - нет ограничений)

            DISPLAY CONFIDENCE
                 Сокращенно: DISP CONF
            Отображение значения истинности
            (По умолчанию - не отображать)

              --------------------------


       CHOICE:

            C>  <текст>
            Список решений, каждой из которых начинается C>

              ---------------------------


       Установка параметров MAXIMUM

       Максимальные значения параметров д.б. заданы
             в первых 20 строках. Эти значения должны
             быть больше, чем то количество, которое
             используется в базе знаний.
       ОБЫЧНО НЕ ТРЕБУЕТСЯ ИЗМЕНЕНИЕ ЗНАЧЕНИЙ, ПРИНИМАЕМЫХ
       ПО УМОЛЧАНИЮ !
       MAXIMUM QUALIFIER =  (По умолчанию =  500)
       MAXIMUM VARIABLE =  (По умолчанию = 500)
       MAXIMUM RULE =  (По умолчанию = 2000)
       MAXIMUM CHOICE =  (По умолчанию = 250)
       MAXIMUM CONFIDENCE =  (По умолчанию = 1000)
       MAXIMUM FORMULA =  (По умолчанию = 1000)

             -----------------------------


       RULE:

            RULE: <необязательное имя>

            IF: <необязательное имя>
                     if_условие 1
            AND:     if_условие 2
            AND:     if_условие 3
            AND:     ...

            THEN:

                     then_условие 1
            AND:     then_условие 2
            AND:     then_условие 3
            AND:     ...

            ELSE:

                     else_условие 1
            AND:     else_условие 2
            AND:     else_условие 3
            AND:     ...

            NOTE: <текст примечания>
            REFERENCE: <текст ссылки>

       1. Значения для показателей должны задаваться в   {}.
       2. Запись решений должно начинаться с    >.
       3. Проверяемая текстовая переменная в условии
       должна начинаться с T> или "4.
       Внутренняя команда   NOT, используемая с текстовой
       переменной должна начинаться с X>.

       Указанное в [] является необязательным.
       Подчеркнутое может быть повторено многократно.
       Заключенное в круглые скобки - минимально требуемое.

       Условия на основе переменных/формул:
       IF-часть:
       [M>] выражение <тест> выражение

       THEN/ELSE-часть:
       переменная ЗАДАНО ЗНАЧЕНИЕ
       выражение
       или
       переменная := выражение
                  -----------------------------

       Показатель в условиях:

              показатель [NOT]  {значение}  [or][and]  [{значение}]
                                            -----------------------
              [поясняющий показатель текст]

                  -----------------------------

       Решения:
       При системах учета истинности  1-4:
       IF:
       > решение[:] [-] Вероятность <тест> значение
       THEN/ELSE:
       > решение[:] [-] Вероятность [=] значение

       Система 5:
       IF:
       > решение[:] [-] Вероятность <тест> выражение
       THEN/ELSE:
       > решение[:] [-] Вероятность [=] выражение

                -------------------------------
       Текст в условиях:

            Только для текстовой переменной:
                      T>   текст
             or       "текст"
             or       [только имя текстовой переменной]

             Для команд:
                      X> команда

       -----------------------------------------------------------

             ПРОСТОЙ ПРИМЕР ЗАПИСИ БАЗЫ ЗНАНИЙ


             Исходный текст базы знаний, подготовленный в любом
             тестовом редакторе, помещен в файл с именем COMPIL
             и имеет следующий вид:

       SUBJECT: Это проба
       AUTHOR: Я
       STARTING TEXT: Начало
       ENDING TEXT: Конец
       EXTERNAL PROGRAM: pct
       DISPLAY THRESHOLD: 1
       PROBABILITY SYSTEM: 1
       INITIAL CHOICE CONFIDENCE: 1
       DISPLAY RULES: Y
       DERIVATION: A
       QUALIFIERS:
       Q>Дождь
       V>сильный
       V>слабый
       DEFAULT CONFIDENCE = 1
       DISPLAY AT END
       NAME: Погода
       CHOICES:
       C> плащ
       C> зонт
       RULE:
       IF:
       Дождь {сильный}
       THEN:
       >плащ: Probability = 1
       NOTE: правило записано в текстовом редакторе
       REFERENCE: это простой пример описания БЗ

             Запуск компилятора осуществляется командой

             ESTERC COMPIL SAVE_STANDARD

             В результате компиляции образуются файлы базы знаний
             COMPIL.TXT и COMPIL.RUL, которые являются входными
             для выполняющей системы ESTER и для редактора базы
             знаний REDBAZ. Сохранение файлов .TXT и .RUL
             осуществляется в стандартной форме совместимой со
             всеми версиями ESTER.
